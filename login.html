<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng nhập</title>

    <!-- Base CSS -->
    <link rel="stylesheet" href="css/base.css" />

    <!-- Font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />

    <!-- CUSTOM STYLE -->
    <style>
      body {
        background: var(--background-small);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.6rem;
      }

      .login-box {
        width: 360px;
        background: var(--background-white);
        padding: 24px;
        border-radius: 8px;
        box-shadow: var(--box-shadow);
      }

      .login-box h2 {
        text-align: center;
        margin-bottom: 20px;
        color: var(--text-black);
      }

      .form-control {
        margin-bottom: 16px;
      }

      .form-control input {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 1.5rem;
        text-transform: none;
      }

      .form-control.error input {
        border-color: var(--text-orange);
      }

      .form-control small {
        display: block;
        min-height: 16px; /* giữ chỗ cố định */
        font-size: 1.3rem;
        color: var(--text-orange);
        margin-top: 4px;
        opacity: 0; /* ẩn nhưng vẫn chiếm chỗ */
        transition: opacity 0.2s ease;
      }

      .form-control.error small {
        opacity: 1;
      }

      .btn-login {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        background: var(--text-blue);
        color: #fff;
        font-size: 1.6rem;
        cursor: pointer;
      }

      .btn-login:hover {
        opacity: 0.9;
      }

      .login-links {
        margin-top: 12px;
        text-align: center;
      }

      /* Link quay về – trung tính */
      .link-back {
        display: block;
        font-size: 1.4rem;
        color: #666;
        text-decoration: none;
      }

      .link-back:hover {
        color: var(--text-black);
        text-decoration: underline;
      }

      /* Link đăng ký – secondary action */
      .link-signup {
        display: block;
        margin-top: 6px;
        font-size: 1.4rem;
        color: var(--text-orange);
        text-decoration: none;
        font-weight: 500;
      }

      .link-signup:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <form class="login-box" id="loginForm">
      <h2>Đăng nhập</h2>

      <div class="form-control">
        <input type="text" id="email" placeholder="Email" />
        <small></small>
      </div>

      <div class="form-control">
        <input type="password" id="password" placeholder="Mật khẩu" />
        <small></small>
      </div>

      <button class="btn-login" type="submit">Đăng nhập</button>

      <div class="login-links">
        <a href="index.html" class="link-back"> ← Quay lại trang chủ </a>

        <a href="signup.html" class="link-signup">
          Chưa có tài khoản? Đăng ký
        </a>
      </div>
    </form>

    <!-- SCRIPT XỬ LÝ LOGIN -->
    <script>
      const form = document.getElementById("loginForm");
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");

      function showError(input, message) {
        const formControl = input.parentElement;
        formControl.classList.add("error");
        formControl.querySelector("small").innerText = message;
      }

      function clearError(input) {
        const formControl = input.parentElement;
        formControl.classList.remove("error");
        formControl.querySelector("small").innerText = "";
      }

      function isValidEmail(email) {
        const regex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        return regex.test(email);
      }

      [emailInput, passwordInput].forEach((input) => {
        input.addEventListener("focus", () => clearError(input));
        input.addEventListener("input", () => clearError(input));
      });

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        let isError = false;

        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();

        /* ===== VALIDATE FORM ===== */
        if (email === "") {
          showError(emailInput, "Vui lòng nhập email");
          isError = true;
        } else if (!isValidEmail(email)) {
          showError(emailInput, "Email không đúng định dạng");
          isError = true;
        }

        if (password === "") {
          showError(passwordInput, "Vui lòng nhập mật khẩu");
          isError = true;
        } else if (password.length < 6) {
          showError(passwordInput, "Mật khẩu tối thiểu 6 ký tự");
          isError = true;
        }

        /* ❌ Nếu form lỗi → dừng luôn */
        if (isError) return;

        /* ===== KIỂM TRA USER ĐÃ ĐĂNG KÝ ===== */
        const savedUser = JSON.parse(localStorage.getItem("userAccount"));

        if (
          !savedUser ||
          savedUser.email !== email ||
          savedUser.password !== password
        ) {
          showError(emailInput, "Email hoặc mật khẩu không đúng");
          showError(passwordInput, "");
          return;
        }

        /* ===== LOGIN THÀNH CÔNG ===== */
        localStorage.setItem(
          "userLogin",
          JSON.stringify({
            email,
            loginAt: new Date().toISOString(),
          })
        );

        window.location.href = "index.html";
      });
    </script>
  </body>
</html>
